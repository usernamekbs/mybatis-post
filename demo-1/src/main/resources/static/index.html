<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery-3.6.3.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous"></head>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
 <meta charset="EUC-KR">
<title>Insert title here</title>
</head>
<body style="background-color:yellow">
<div class="input-group mb-3">
  <span class="input-group-text" id="basic-addon1">제목</span>
  <input type="text" class="form-control" id="title" placeholder="제목" aria-label="Username" aria-describedby="basic-addon1">
</div>
<div class="input-group mb-3">
  <span class="input-group-text" id="basic-addon1">내용</span>
  <input type="text" class="form-control" id="content" placeholder="내용" aria-label="Username" aria-describedby="basic-addon1">
</div>
<div class="input-group mb-3">
  <span class="input-group-text" id="basic-addon1">작성자</span>
  <input type="text" class="form-control"   id="writer" placeholder="작성자" aria-label="Username" aria-describedby="basic-addon1">
</div>
<button type="button" class="btn btn-info"  onClick="savePost()" >저장</button>

<button type="button" class="btn btn-success"  onClick="listPost()">조회</button>

<div id="detail">

</div>

<div id='list'>

</div>
<div class="input-group mb-3">
  <input type="text" class="form-control" id="srch_title" placeholder="제목을 입력해주세요" aria-label="제목을 입력해주세요" aria-describedby="button-addon2">
  <button class="btn btn-outline-secondary" type="button" id="button-addon2" onclick="listPost()">검색</button>
</div>

<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">수정</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
     	<div class="input-group mb-3">
	  <span class="input-group-text" id="basic-addon1">번호</span>
	  <input type="text" class="form-control" id="upd_ano" aria-describedby="basic-addon1">
	</div>
	<div class="input-group mb-3">
	  <span class="input-group-text" id="basic-addon1">제목</span>
	  <input type="text" class="form-control" id="upd_title"  aria-describedby="basic-addon1">
	</div>
	<div class="input-group mb-3">
	  <span class="input-group-text" id="basic-addon1">내용</span>
	  <input type="text" class="form-control" id="upd_content"  aria-describedby="basic-addon1">
	</div>
	<div class="input-group mb-3">
	  <span class="input-group-text" id="basic-addon1">작성자</span>
	  <input type="text" class="form-control"   id="upd_writer" aria-describedby="basic-addon1">
	</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
        <button type="button" class="btn btn-primary" id="change" >확인</button>
      </div>
    </div>
  </div>
</div>
  
<script>
function savePost(){
		var title  = $("#title").val();
		var content  = $("#content").val();
		var writer  = $("#writer").val();
		
		$.ajax({
		    type : 'post',           
		    url : '/create',           
		    dataType : 'text',       
		    data : JSON.stringify({  
		      "title" : title,
		      "content" : content,
		      "writer" : writer
		    }),
		    contentType: 'application/json',
		    success : function(result) { 
		    	 listPost()
		    	 $("#title").val('')
		    	 $("#content").val('')
		    	 $("#writer").val('')
		    },
		    error : function(request, status, error) { // 결과 에러 콜백함수
		        console.log(error)
		    }
		})
}

function listPost(){
	var srch_title = $("#srch_title").val()
	
	$.ajax({
	    type : 'get',          
	    url : '/list',    
	    data : { 
		      "srch_title" : srch_title
	    },
	    success : function(result) {  
				var html="";
				if(result.length > 0){
					html+= "<p><span>게시글 개수:</span>"+result[0].cnt+"</p>"
				}else{
					html+="<p>데이터가 없습니다.</p>"
				}
				html+=	"<table class='table'>";
				html+=	"<thead>" 
				html+=	    "<tr>"
				html+=	      "<th scope='col'>Ano</th>"
				html+=	      "<th scope='col'>Title</th>"
				html+=	      "<th scope='col'>Content</th>"
				html+=	      "<th scope='col'>Writer</th>"
				html+=	      "<th scope='col'>삭제</th>"
				html+=	      "<th scope='col'>수정</th>"
				html+=	      "<th scope='col'>보기</th>"
				html+=	    "</tr>"
				html+=	"</thead>" 
				html+=	"<tbody>" 
				html+=		"<tr>" 
				for(var i=1 in result){  
				html+=	 		"<th scope='row'>"+result[i].ano+"</th>"
			 	html+=      	"<td>"+result[i].title+"</td>"
				html+=      	"<td>"+result[i].content+"</td>"  
				html+=      	"<td>"+result[i].writer+"</td>"  
				html+=      	"<td><button class='btn btn-warning' onclick=deletePost('"+result[i].ano+"')>삭제</button></td>" 
				html+=          "<td><button type='button' class='btn btn-primary' id='openModalBtn' onclick='updateDetailPost(" +result[i].ano + "," + "\""+result[i].title+ "\""+ "," + "\""+result[i].content+ "\"" + "," + "\""+result[i].writer+ "\"" + ");'>수정</button></td>" 
				html+=      	"<td><button class='btn btn-success' onclick=detailPost('"+result[i].ano+"')>보기</button></td>" 
				html+=		"</tr>"  
				
				}
			 	html+=	"</tbody>"
			 	html+= "</table>" 
			 	
			
		  	$("#list").html(html);
	    },
	    error : function(request, status, error) { // 결과 에러 콜백함수
	        console.log(error)
	    }
	})
}

function deletePost(ano){
	
	$.ajax({
	    type : 'delete',           // 타입 (get, post, put 등등)
	    url : '/delete',           // 요청할 서버url
	    dataType : 'text',       // 데이터 타입 (html, xml, json, text 등등)
	    data : JSON.stringify({  // 보낼 데이터 (Object , String, Array)
	      "ano" : ano
	    }),
	    contentType: 'application/json',
	    success : function(result) { // 
	    	listPost()
	    },
	    error : function(request, status, error) { // 결과 에러 콜백함수
	        console.log(error)
	    }
	}) 
}


function detailPost(ano){
	$.ajax({
	    type : 'get',          
	    url : '/detail',     
	    data : { 
		      "ano" : ano
	    },
	    success : function(result) {  
	    	var html="";
	    	
	    	html+= "<p><span>번호 : </span>"+result.ano+"</p>"
	    	html+= "<p><span>제목 : </span>"+result.title+"</p>"
	    	html+= "<p><span>내용 : </span>"+result.content+"</p>"
	    	html+= "<p><span>작성자 : </span>"+result.writer+"</p>"
	     	$("#detail").html(html);
	    },
	    error : function(request, status, error) { // 결과 에러 콜백함수
	        console.log(error)
	    }
	})
}

function updateDetailPost(ano,title,content,writer){
	$("#staticBackdrop").modal("show");
	$("#upd_ano").val(ano);
	$("#upd_title").val(title);
	$("#upd_content").val(content);
	$("#upd_writer").val(writer);
	
	$('#change').click(function(){
		updatePost(ano)
	});
}

function updatePost(ano){
		$.ajax({
		    type : 'post',           
		    url : '/update',           
		    data : {  
		      "ano"     : $("#upd_ano").val(),
		      "title"   : $("#upd_title").val(),
		      "content" : $("#upd_content").val(),
		      "writer"  : $("#upd_writer").val()
		    },
		    success : function(result) { 
		    	$("#staticBackdrop").modal("hide");
		    	 listPost()
		    },
		    error : function(request, status, error) { // 결과 에러 콜백함수
		        console.log(error)
		    }
		})
}
</script>
</body>
</html>

